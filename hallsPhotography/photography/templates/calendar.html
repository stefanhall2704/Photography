<html>
<body>
{% include "navbar.html" %}

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.1/mdb.min.js"></script>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital@1&display=swap" rel="stylesheet" />

  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <style>
    .lora-font {
      font-family: "Lora", serif;
    }
  </style>
  <!-- MDB -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.1/mdb.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital@1&display=swap" rel="stylesheet" />
  <style>
    /* Center the calendar within its container */
    table {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 30%;
      background-color: #fff;
      /* White background */
    }

    < !-- #pagination {
      -->< !-- display: flex;
      -->< !-- align-items: center;
      -->< !-- height: 100vh;
      -->< !--
    }

    -->

    /* Calendar styling */
    .month {
      font-family: "Arial", sans-serif;
      color: #000;
      text-align: center;
      font-size: 24px;
      background: gray;
      padding: 10px 0;
      heigh: 50px;
    }

    .mon,
    .tue,
    .wed,
    .thu,
    .fri {
      font-family: "Arial", sans-serif;
      font-weight: bold;
      text-align: center;
      width: 30px;
      height: 30px;
      background: #fb8b24;
      color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
    }

    .sat,
    .sun {
      font-family: "Arial", sans-serif;
      font-weight: bold;
      text-align: center;
      width: 30px;
      height: 30px;
      background-color: #9a031e;
      /* Weekend background color */
      color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
    }

    .noday {
      font-family: "Arial", sans-serif;
      font-weight: bold;
      text-align: center;
      width: 30px;
      height: 30px;
      background: #fb8b24;
      color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
    }

    #previous {
      background-color: #9a031e;
    }

    #next_button {
      background-color: #9a031e;
    }

    .highlight-day {
      background-color: yellow;
      /* Change the background color as an example */
      /* Add more CSS rules as needed */
    }

    .pagination {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: gray;
      height: 100%;
    }

.pagination_buttons {
  text-align: center; /* Align buttons in the center */
  margin-bottom: 15px; /* Adjust margin as needed */
}

.pagination_buttons button[type="button"] {
  padding: 8px 16px;
  font-size: 14px;
  background-color: #9a031e;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-right: 10px; /* Adjust margin if needed */
}

.pagination_buttons button[type="button"]:hover {
  background-color: #7a0220;
}
body {
  background-color: #ccc; /* Change the background color of the entire page */
  margin: 0;
  padding: 0;
}
.form-wrapper {
  max-width: 500px; /* Adjust the maximum width as needed */
  margin: 50px auto;
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  background-color: #fff;
}

.form-content {
  margin-bottom: 20px;
}

button {
  padding: 8px 16px;
  font-size: 14px;
  background-color: #9a031e;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-right: 10px; /* Adjust margin if needed */
  z-index: -1; /* Ensure buttons are in the foreground */
}

button:hover {
  background-color: #7a0220;
}

/* Add this CSS to visually indicate disabled dates */
.disabled-date {
  pointer-events: none; /* Disable pointer events */
  background-color: #ccc; /* Change background color for disabled dates */
  /* You can add other styles as needed */
}
  </style>




<!-- Example script to update the calendar -->
<script>

document.addEventListener("DOMContentLoaded", function () {
  const currentMonth = parseInt(document.getElementById("month").value);
  const currentYear = parseInt(document.getElementById("year").value);

  const currentDate = new Date(); // Get the current date
  const currentDay = currentDate.getDate();

  // Calculate the last day of the current month
  const lastDay = new Date(currentYear, currentMonth, 0).getDate();

  // Calculate the date 2 weeks from now
  const twoWeeksFromNow = new Date();
  twoWeeksFromNow.setDate(currentDate.getDate() + 14);

  // Calculate the last date to enable (2 weeks from now)
  const lastEnabledDate = twoWeeksFromNow.getDate();

  // Fetch events
  const start_time = `${currentYear}-${currentMonth}-01T00:00:00Z`;
  const end_time = `${currentYear}-${currentMonth}-${lastDay}T23:59:59Z`;

  fetch('/get-events/?start_time=' + start_time + '&end_time=' + end_time)
    .then(response => response.json())
    .then(data => {
      try {
        console.log('Fetched Data:', data);

        // Ensure that the fetched data contains events
        if (Array.isArray(data)) {
          const events = data;
          console.log('Events:', events);
          const dialog = document.createElement("dialog");
          document.body.appendChild(dialog);

          const eventCountPerDay = {};

          events.forEach(function (event) {
            // console.log('Event:', event);
            if (event.start && event.start.dateTime) {
              const eventDate = new Date(event.start.dateTime);
              // Check if the event falls within the current month
              if (
                eventDate.getFullYear() === currentYear &&
                eventDate.getMonth() + 1 === currentMonth
              ) {
                const dayOfMonth = eventDate.getDate();
                if (eventCountPerDay[dayOfMonth]) {
                  eventCountPerDay[dayOfMonth]++;
                } else {
                  eventCountPerDay[dayOfMonth] = 1;
                }
              }
            }
          });

          const tableDataElements = document.querySelectorAll("table td");
          tableDataElements.forEach(function (td) {
            const day = parseInt(td.textContent.trim());

            if (eventCountPerDay[day]) {
              if (eventCountPerDay[day] > 1) {
                td.style.backgroundColor = "#ccc";
              } else {
                td.style.backgroundColor = "#3498db";
                td.style.cursor = "pointer";

                td.addEventListener("click", function () {
                  while (dialog.firstChild) {
                    dialog.removeChild(dialog.firstChild);
                  }

                  const title = document.createElement("h2");
                  title.textContent = `Events for Day ${day}`;
                  dialog.appendChild(title);

                  const eventsList = document.createElement("ul");
                  events.forEach(function (event) {
                    if (
                      event.start &&
                      event.start.dateTime &&
                      new Date(event.start.dateTime).getDate() === day
                    ) {
                      const listItem = document.createElement("li");
                      console.log(event);
                      listItem.textContent = event.summary;
                      eventsList.appendChild(listItem);
                    }
                  });

                  dialog.appendChild(eventsList);

                  const closeButton = document.createElement("button");
                  closeButton.textContent = "Close";
                  closeButton.addEventListener("click", function () {
                    dialog.close();
                  });

                  dialog.appendChild(closeButton);
                  dialog.showModal();
                });
              }
              // Code to handle events
              // ... (existing event handling code)
            } else {
              // Code to disable dates not having events

              const dateToCheck = new Date(currentYear, currentMonth - 1, day);

              if (
                (currentMonth === currentDate.getMonth() + 1 && day < currentDay) ||
                (day > lastEnabledDate && currentMonth === twoWeeksFromNow.getMonth() + 1) ||
                (dateToCheck < currentDate)
              ) {

                  td.classList.add("disabled-date"); // Add a class to visually indicate disabled dates
                  // td.removeAttribute("style"); // Remove any previous styles
                  td.removeAttribute("onclick"); // Remove click event to disable selection
              }
            }
          });
        } else {
          console.error('No events found or invalid data format.');
        }
      } catch (error) {
        console.error("Error:", error);
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
});
</script>


  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Get the day value from the hidden input element
      const day = document.getElementById("day").value;

      if (day != 0) {
        // Find all table data (td) elements in the table
        const tableDataElements = document.querySelectorAll("table td");

        // Loop through the table data elements and compare their text content to the day value
        tableDataElements.forEach(function (td) {
          if (td.textContent.trim() === day) {
            // Add CSS styles to change the appearance of the matching table cell
            td.style.backgroundColor = "#e36414"; // Change background color as an example
            // You can apply other CSS styles as needed
          }
        });
      }
    });
  </script>

  <script>
    function changeMonth(offset) {
      var currentMonth = parseInt($("#month").val());
      var currentYear = parseInt($("#year").val());

      // Calculate the new month and year
      var newMonth = currentMonth + offset;
      var newYear = currentYear;

      if (newMonth > 12) {
        newMonth = 1;
        newYear++;
      } else if (newMonth < 1) {
        newMonth = 12;
        newYear--;
      }

      // Update the hidden input fields
      $("#month").val(newMonth);
      $("#year").val(newYear);

      // Reload the page with the new URL
      window.location.href = `/schedule/${newYear}/${newMonth}`;
    }
  </script>
</head>
<form id="dateSelectionForm">
  <input id="day" type="hidden" name="day" value="{{day}}" />
  <input id="month" type="hidden" name="month" value="{{month}}" />
  <input id="year" type="hidden" name="year" value="{{year}}" />
  <div class="form-wrapper">
    <div class="form-content">
      <div class="pagination_buttons">
        <button type="button" id="previous" onclick="changeMonth(-1)">Previous Month</button>
        <button type="button" id="next_button" onclick="changeMonth(1)">Next Month</button>
      </div>
      <div class="pagination">
        <br>
        <div class="calendar-container" id="calendarContainer">{{calendar|safe}}</div>
      </div>
    </div>
    <button type="submit">Proceed to Payment</button>
  </div>
</form>
</body>
</html>
